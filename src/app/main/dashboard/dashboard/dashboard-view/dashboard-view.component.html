<mat-drawer-container [hasBackdrop]="false" fxFlex="100%" xmlns="http://www.w3.org/1999/html">
  <mat-drawer #drawer class="drawer-container" mode="'over'" position="end">
    <div class="p-16" fxLayout="column">
      <div class="mb-12">
        <button (click)="drawer.toggle()" class="b-secondary" mat-icon-button>
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
      <div style="margin-left: -16px; margin-right: -16px">
        <mat-divider></mat-divider>
      </div>
      <div class="mt-20">
        <mat-icon>info</mat-icon>
      </div>
      <p>Wordt bewust van je energie opwekking en opnamen</p>


      <div class="mt-16">
        <!-- <mat-card> -->
        <ng-container *ngIf="meter">
          <div>
            <p class="mat-title">In deze periode</p>
            <p>
              <em>van {{rangePickerForm.get('timestamp_after').value | date: "short"}}</em><br/>
              <em>tot {{rangePickerForm.get('timestamp_before').value | date: "short"}}</em><br/>
            </p>
            <p>
              Stroom import (1): {{meter.period_import_1}}<br/>
              Stroom import (2): {{meter.period_import_2}}<br/>
              Stroom export (1): {{meter.period_export_1}}<br/>
              Stroom export (2): {{meter.period_export_2}}<br/>
              Zonproductie: {{meter.period_gas}}<br/>
              Gas: {{meter.period_solar}}<br/>
            </p>
          </div>
          <div>
            <p class="mat-title">Stroom</p>
            <p>
              <em>Laatste update {{meter.power_timestamp | date: "dd-MM-yy HH:mm:ss"}}</em><br/>
            </p>
            <p>
              Actueel: {{meter.actualPower | number }} kW (Tarief: {{meter.tariff | number }})<br/>
            </p>
            <p>
              Import 1: {{meter.total_power_import_1 | number }} kWh <br/>
              Import 2: {{meter.total_power_import_2 | number }} kWh <br/>
              Export 1: {{meter.total_power_export_1 | number }} kWh <br/>
              Export 2: {{meter.total_power_export_2 | number }} kWh <br/>
              --- <br/>
              Totaal import: {{meter.totalPowerImport | number }} kWh <br/>
              Totaal export: {{meter.totalPowerExport | number }} kWh <br/>
              Meter balans: {{meter.totalPower | number }} kWh <br/>
            </p>
          </div>
          <p class="mat-title">Solar</p>
          <p *ngIf="meter.total_gas > 0">
            <em>Laatste update {{meter.gas_timestamp | date: "dd-MM-yy HH:mm:ss"}}</em><br/>
            Totaal gasverbruik: {{meter.total_gas | number }} m³ <br/>
          </p>
          <p *ngIf="meter.total_solar">
            <em>Laatste update {{meter.solar_timestamp | date: "dd-MM-yy HH:mm:ss"}}</em><br/>
            Totaal zonproductie: {{meter.total_solar | number }} kW <br/>
          </p>
          <h3>Actueel</h3>
          <p *ngIf="meter.total_gas">
            Gasverbruik: {{meter.actual_gas | number }} m³/h <br/>
          </p>
          <p *ngIf="meter.solar_timestamp">
            Zonproductie: {{meter.actual_solar | number }} kW <br/>
          </p>
        </ng-container>
        <!-- </mat-card> -->
      </div>

    </div>

  </mat-drawer>
  <mat-drawer-content>

    <div fxLayout="column">
      <div class="p-16" fxLayout="row">

        <div fxFlex>
          <p class="mat-body-2 mt-8 mb--12">{{meter?.name}} gegevens</p>
        </div>
        <div class="ml-8">

          <button (click)="drawer.toggle()" mat-stroked-button>
            <mat-icon>info</mat-icon>
            <span class="mat-caption" style="color: black;">
              Meter details
            </span>
          </button>
        </div>


        <!-- <button mat-stroked-button *ngIf="groupMeter?.public" class="float-right" style="float: right">
          <span style="color: black;" class="mat-caption">
            <a [href]="groupMeter.publicUrl" target="_blank">Publieke link</a>
          </span>
        </button> -->

      </div>

      <div>
        <mat-divider></mat-divider>
      </div>

      <div class="mt-40 mb-40" fxFlex="100%" fxLayout="row">
        <div fxFlex="5%" fxFlex.xs="2.5%"></div>
        <div fxFlex="90%" fxFlex.xs="95%">

          <div fxLayout="column" fxLayoutGap="32px">

            <mat-card fxFlex="100%">

              <form *ngIf="rangePickerForm" [formGroup]="rangePickerForm">

                <mat-form-field appearance="outline" fxFlex="100%">

                  <mat-label>
                    Periode
                  </mat-label>
                  <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="start center">
                    <input matInput [placeholder]="'ORGANIZATIONS.NAME' | translate" autocomplete="off" [matMenuTriggerFor]="rangeMenu"
                           [value]="rangePickerForm.get('timestamp_after').value | date: 'short'" style="width: auto">
                    <span style="margin: 0 15px">-</span>
                    <input matInput [placeholder]="'ORGANIZATIONS.NAME' | translate" autocomplete="off" [matMenuTriggerFor]="rangeMenu"
                           [value]="rangePickerForm.get('timestamp_before').value | date: 'short'" style="width: auto">

                  </div>


                  <mat-menu #rangeMenu="matMenu" focusFirstItem="false">
                    <button mat-menu-item (click)="rangePicker.open()">
                      Custom datum
                    </button>
                    <mat-divider></mat-divider>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.day)">
                      Afgelopen 24 uur
                    </button>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.week)">
                      Afgelopen week
                    </button>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.month)">
                      Afgelopen maand
                    </button>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.year)">
                      Afgelopen Jaar
                    </button>
                    <mat-divider></mat-divider>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.current_day)">
                      Vandaag
                    </button>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.current_week)">
                      Deze week
                    </button>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.current_month)">
                      Deze maand
                    </button>
                    <button mat-menu-item (click)="onRangeFilterChange(filterRangeOptions.current_year)">
                      Dit jaar
                    </button>
                  </mat-menu>

                  <div [hidden]="true">
                    <mat-date-range-input [formGroup]="rangePickerForm" [rangePicker]="rangePicker">
                      <input matStartDate placeholder="Start datum" formControlName="timestamp_after"
                             [rangePicker]="rangePicker" (mousedown)="rangePicker.open(); $event.preventDefault"
                             readonly=true>
                      <input matEndDate placeholder="Eind datum" formControlName="timestamp_before"
                             [rangePicker]="rangePicker"
                             (mousedown)="rangePicker.open(); $event.preventDefault" readonly=true>
                    </mat-date-range-input>
                  </div>
                  <mat-datepicker-toggle matSuffix [for]="rangePicker"></mat-datepicker-toggle>
                  <mat-date-range-picker #rangePicker (closed)="closedRangePicker()"></mat-date-range-picker>
                </mat-form-field>


                <div>
                    <!-- <mat-form-field appearance="outline" fxFlex="155px" class="mr-8 ml-16">
                    <mat-label>Start</mat-label>
                    <input matInput formControlName="start" autocomplete="off" readonly>
                  </mat-form-field>

                  <mat-form-field appearance="outline" fxFlex="155px" class="mr-8 ml-8">
                    <mat-label>Eind</mat-label>
                    <input matInput formControlName="end" autocomplete="off" readonly>
                  </mat-form-field> -->
                </div>

              </form>

            </mat-card>

            <mat-card fxFlex="100%">

              <ng-container *ngIf="loadingEnergy; else energyChart">
                <div class="mt-40 mb-40" fxLayout="column" fxLayoutAlign="center center">
                  <mat-spinner></mat-spinner>
                  <div class="mt-20 mat-body-2">
                    Data aan het laden
                  </div>
                </div>
              </ng-container>

              <ng-template #energyChart>
                <dashboard-graph [chartInput]="energyChartInput" yAxisLabel="Stroom (kW)"></dashboard-graph>
              </ng-template>

            </mat-card>


            <mat-card fxFlex="100%">

              <ng-container *ngIf="loadingGas; else gasChart">
                <div class="mt-40 mb-40" fxLayout="column" fxLayoutAlign="center center">
                  <mat-spinner></mat-spinner>
                  <div class="mt-20 mat-body-2">
                    Data aan het laden
                  </div>
                </div>
              </ng-container>

              <ng-template #gasChart>
                <dashboard-graph [chartInput]="gasChartInput" yAxisLabel="Gas (m³/h)"></dashboard-graph>
              </ng-template>

            </mat-card>
          </div>


          <!-- </div> -->


        </div>
        <div fxFlex="5%" fxFlex.xs="2.5%"></div>
      </div>
    </div>

  </mat-drawer-content>
</mat-drawer-container>
